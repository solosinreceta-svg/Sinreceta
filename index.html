<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PediaCalc HPJRM v9.3.1</title>
    <style>
        :root {
            --primary-color: #1a73e8;
            --secondary-color: #34a853;
            --accent-color: #fbbc05;
            --danger-color: #ea4335;
            --light-bg: #f8f9fa;
            --dark-bg: #202124;
            --light-text: #333;
            --dark-text: #f8f9fa;
            --card-bg: #ffffff;
            --card-shadow: 0 2px 10px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
            --border-radius: 8px;
        }

        .dark-theme {
            --light-bg: #202124;
            --dark-bg: #f8f9fa;
            --light-text: #f8f9fa;
            --dark-text: #333;
            --card-bg: #303134;
            --card-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--light-text);
            transition: var(--transition);
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Styles */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo h1 {
            font-size: 1.5rem;
            margin-left: 10px;
        }

        .menu-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .menu-toggle:hover {
            background-color: rgba(255,255,255,0.1);
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background-color: var(--card-bg);
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: var(--transition);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .sidebar.active {
            right: 0;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .sidebar-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light-text);
        }

        .sidebar-nav ul {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 10px;
        }

        .sidebar-nav a {
            display: block;
            padding: 12px 15px;
            color: var(--light-text);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .sidebar-nav a:hover, .sidebar-nav a.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Main Content Styles */
        main {
            padding: 20px 0;
            min-height: calc(100vh - 140px);
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-header {
            margin-bottom: 20px;
            text-align: left;
        }

        .section-header h2 {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        /* Card Styles */
        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 20px;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .card-title {
            font-size: 1.3rem;
            color: var(--primary-color);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: var(--card-bg);
            color: var(--light-text);
            transition: var(--transition);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            text-align: center;
            text-decoration: none;
        }

        .btn:hover {
            background-color: #0d62d9;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: #2e8b47;
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #d33426;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        /* Calculator Styles */
        .calculator-steps {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .step {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 10px;
            background-color: #e9ecef;
            color: #6c757d;
            border-radius: var(--border-radius);
            margin: 0 5px;
            transition: var(--transition);
        }

        .step.active {
            background-color: var(--primary-color);
            color: white;
        }

        .result-card {
            display: none;
            margin-top: 20px;
            border-left: 4px solid var(--primary-color);
        }

        .result-card.active {
            display: block;
        }

        /* Database Styles */
        .search-box {
            margin-bottom: 20px;
        }

        .medicines-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .medicine-card {
            cursor: pointer;
        }

        .medicine-family {
            font-size: 0.9rem;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .medicine-details {
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .medicine-details p {
            margin-bottom: 5px;
        }

        /* Management Styles */
        .management-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .medicine-form {
            max-width: 600px;
        }

        .presentation-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            align-items: center;
        }

        .presentation-item input {
            flex: 1;
        }

        .medicine-list {
            display: grid;
            gap: 15px;
        }

        .medicine-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
        }

        .medicine-info {
            flex: 1;
        }

        .medicine-actions {
            display: flex;
            gap: 10px;
        }

        /* Settings Styles */
        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Footer Styles */
        footer {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            text-align: center;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                right: -100%;
            }
            
            .calculator-steps {
                flex-direction: column;
            }
            
            .step {
                margin: 5px 0;
            }
            
            .medicines-grid {
                grid-template-columns: 1fr;
            }
            
            .management-actions {
                flex-direction: column;
            }
            
            .medicine-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .medicine-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: flex-end;
            }
        }

        /* Terms Styles */
        .terms-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .terms-content {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
        }

        .countdown {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        /* Welcome Styles */
        .welcome-container {
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-icon {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .welcome-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* Alert Styles */
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light-text);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Import/Export Styles */
        .data-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .file-label:hover {
            background-color: #2e8b47;
        }

        .github-url {
            width: 100%;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Terms Modal -->
    <div class="modal" id="termsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Términos y Condiciones</h3>
                <button class="modal-close" id="termsClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="terms-content">
                    <h4>1. Aceptación de los Términos</h4>
                    <p>Al utilizar PediaCalc HPJRM v9.3.1, usted acepta cumplir con estos términos y condiciones.</p>
                    
                    <h4>2. Propósito de la Aplicación</h4>
                    <p>PediaCalc es una herramienta de cálculo de dosis pediátricas diseñada para profesionales de la salud.</p>
                    
                    <h4>3. Limitación de Responsabilidad</h4>
                    <p>Los desarrolladores no se hacen responsables de errores en los cálculos. El usuario es responsable de verificar todas las dosificaciones.</p>
                    
                    <h4>4. Uso Apropiado</h4>
                    <p>Esta aplicación está destinada exclusivamente para uso por parte de profesionales de la salud calificados.</p>
                </div>
                <div class="countdown" id="countdown">Aceptar términos en: 10 segundos</div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="acceptTerms" disabled>Aceptar Términos</button>
            </div>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div class="section active" id="welcomeSection">
        <div class="welcome-container">
            <div class="welcome-icon">👶</div>
            <h1>Bienvenido a PediaCalc HPJRM v9.3.1</h1>
            <p>Herramienta avanzada para cálculo de dosis pediátricas</p>
            <div class="welcome-buttons">
                <button class="btn" id="startApp">Comenzar</button>
                <button class="btn btn-secondary" id="viewTerms">Ver Términos</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <h1>PediaCalc HPJRM v9.3.1</h1>
                    </div>
                    <button class="menu-toggle" id="menuToggle">☰</button>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Menú</h3>
                <button class="sidebar-close" id="sidebarClose">&times;</button>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" class="nav-link active" data-section="calculator">Calculadora</a></li>
                    <li><a href="#" class="nav-link" data-section="database">Base de Datos</a></li>
                    <li><a href="#" class="nav-link" data-section="management">Gestión</a></li>
                    <li><a href="#" class="nav-link" data-section="settings">Configuración</a></li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <main>
            <div class="container">
                <!-- Calculator Section -->
                <section class="section active" id="calculatorSection">
                    <div class="section-header">
                        <h2>Calculadora de Dosis Pediátricas</h2>
                        <p>Calcule dosis de medicamentos de forma rápida y precisa</p>
                    </div>
                    
                    <div class="calculator-steps">
                        <div class="step active" id="step1">1. Peso</div>
                        <div class="step" id="step2">2. Medicamento</div>
                        <div class="step" id="step3">3. Presentación</div>
                        <div class="step" id="step4">4. Calcular</div>
                    </div>
                    
                    <div class="card">
                        <div class="form-group">
                            <label for="patientWeight">Peso (kg)</label>
                            <input type="number" id="patientWeight" min="0.1" step="0.1" placeholder="Ej: 15.5" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="medicineCategory">Categoría de Medicamento</label>
                            <select id="medicineCategory">
                                <option value="">Todas las categorías</option>
                                <option value="antibioticos">Antibióticos</option>
                                <option value="analgesicos">Analgésicos/Antipiréticos</option>
                                <option value="broncodilatadores">Broncodilatadores</option>
                                <option value="antihistaminicos">Antihistamínicos</option>
                                <option value="corticoides">Corticoides</option>
                                <option value="gastrointestinales">Gastrointestinales</option>
                                <option value="anticonvulsivantes">Anticonvulsivantes</option>
                                <option value="antiparasitarios">Antiparasitarios</option>
                                <option value="antivirales">Antivirales</option>
                                <option value="antifungicos">Antifúngicos</option>
                                <option value="suplementos">Suplementos</option>
                                <option value="otros">Otros</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="medicineSelect">Medicamento</label>
                            <select id="medicineSelect" required>
                                <option value="">Seleccione un medicamento</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="presentationSelect">Presentación</label>
                            <select id="presentationSelect" required>
                                <option value="">Seleccione una presentación</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="dilutionGroup" style="display: none;">
                            <label for="dilutionVolume">Volumen de Dilución (ml)</label>
                            <input type="number" id="dilutionVolume" min="1" placeholder="Ej: 5">
                        </div>
                        
                        <button class="btn btn-block" id="calculateBtn">Calcular Dosis</button>
                    </div>
                    
                    <div class="card result-card" id="resultCard">
                        <div class="card-header">
                            <h3 class="card-title">Resultado del Cálculo</h3>
                            <button class="btn btn-secondary" id="closeResult">Cerrar</button>
                        </div>
                        <div id="resultContent"></div>
                    </div>
                </section>

                <!-- Database Section -->
                <section class="section" id="databaseSection">
                    <div class="section-header">
                        <h2>Base de Datos de Medicamentos</h2>
                        <p>Explore la completa base de datos de medicamentos pediátricos</p>
                    </div>
                    
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Buscar medicamento por nombre, familia o vía...">
                    </div>
                    
                    <div class="medicines-grid" id="medicinesGrid"></div>
                </section>

                <!-- Management Section -->
                <section class="section" id="managementSection">
                    <div class="section-header">
                        <h2>Gestión de Medicamentos</h2>
                        <p>Agregue, edite o elimine medicamentos de la base de datos</p>
                    </div>
                    
                    <div class="data-actions">
                        <button class="btn" id="addMedicineBtn">➕ Agregar Medicamento</button>
                        <button class="btn btn-secondary" id="exportDataBtn">📤 Exportar Datos</button>
                        <label class="file-label" for="importFile">📥 Importar Datos</label>
                        <input type="file" id="importFile" class="file-input" accept=".json">
                        <button class="btn btn-secondary" id="updateFromGithubBtn">🔄 Actualizar desde GitHub</button>
                    </div>
                    
                    <div class="card">
                        <input type="text" id="githubUrl" class="github-url" placeholder="URL del archivo JSON en GitHub (opcional)">
                    </div>
                    
                    <div class="card medicine-form" id="medicineForm" style="display: none;">
                        <div class="card-header">
                            <h3 class="card-title" id="formTitle">Agregar Nuevo Medicamento</h3>
                        </div>
                        <form id="medicineFormElement">
                            <input type="hidden" id="medicineId">
                            
                            <div class="form-group">
                                <label for="formName">Nombre del Medicamento *</label>
                                <input type="text" id="formName" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="formFamily">Familia/Categoría *</label>
                                <select id="formFamily" required>
                                    <option value="">Seleccione una familia</option>
                                    <option value="antibioticos">Antibióticos</option>
                                    <option value="analgesicos">Analgésicos/Antipiréticos</option>
                                    <option value="broncodilatadores">Broncodilatadores</option>
                                    <option value="antihistaminicos">Antihistamínicos</option>
                                    <option value="corticoides">Corticoides</option>
                                    <option value="gastrointestinales">Gastrointestinales</option>
                                    <option value="anticonvulsivantes">Anticonvulsivantes</option>
                                    <option value="antiparasitarios">Antiparasitarios</option>
                                    <option value="antivirales">Antivirales</option>
                                    <option value="antifungicos">Antifúngicos</option>
                                    <option value="suplementos">Suplementos</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="formDoseHabitual">Dosis Habitual (por kg/día) *</label>
                                <input type="number" id="formDoseHabitual" step="0.1" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="formUnit">Unidad de medida *</label>
                                <select id="formUnit" required>
                                    <option value="mg">mg</option>
                                    <option value="UI">UI</option>
                                    <option value="mcg">mcg</option>
                                    <option value="g">g</option>
                                    <option value="ml">ml</option>
                                    <option value="gotas">gotas</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="formFrequency">Frecuencia de Administración *</label>
                                <input type="text" id="formFrequency" placeholder="Ej: Cada 8 horas" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Presentaciones *</label>
                                <div id="presentationsContainer"></div>
                                <button type="button" class="btn btn-secondary" id="addPresentationBtn">➕ Agregar Presentación</button>
                            </div>
                            
                            <div class="form-group">
                                <label for="formDoseMaxDaily">Dosis Máxima Diaria (opcional)</label>
                                <input type="number" id="formDoseMaxDaily" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label for="formDoseMaxSingle">Dosis Máxima por Toma (opcional)</label>
                                <input type="number" id="formDoseMaxSingle" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label for="formIndications">Indicaciones (separadas por coma)</label>
                                <textarea id="formIndications" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="formAlerts">Alertas/Precauciones (separadas por coma)</label>
                                <textarea id="formAlerts" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="formLiofilizado"> Requiere reconstitución (liofilizado)
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label for="formDilution">Volumen de dilución estándar (ml)</label>
                                <input type="number" id="formDilution" min="0" step="0.1" value="10">
                            </div>
                            
                            <div class="form-group">
                                <button type="submit" class="btn btn-block">💾 Guardar Medicamento</button>
                                <button type="button" class="btn btn-secondary btn-block" id="cancelFormBtn">❌ Cancelar</button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="managementList" class="medicine-list"></div>
                </section>

                <!-- Settings Section -->
                <section class="section" id="settingsSection">
                    <div class="section-header">
                        <h2>Configuración</h2>
                        <p>Personalice la aplicación según sus preferencias</p>
                    </div>
                    
                    <div class="card">
                        <div class="settings-option">
                            <div>
                                <h3>Tema Oscuro</h3>
                                <p>Cambiar entre tema claro y oscuro</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-option">
                            <div>
                                <h3>Tamaño de Fuente</h3>
                                <p>Ajustar el tamaño del texto</p>
                            </div>
                            <select id="fontSizeSelect">
                                <option value="small">Pequeño</option>
                                <option value="medium" selected>Mediano</option>
                                <option value="large">Grande</option>
                            </select>
                        </div>
                        
                        <div class="settings-option">
                            <div>
                                <h3>Exportar Datos</h3>
                                <p>Descargar una copia de la base de datos</p>
                            </div>
                            <button class="btn" id="exportSettingsBtn">📤 Exportar</button>
                        </div>
                        
                        <div class="settings-option">
                            <div>
                                <h3>Restablecer Datos</h3>
                                <p>Volver a la base de datos original</p>
                            </div>
                            <button class="btn btn-danger" id="resetDataBtn">🔄 Restablecer</button>
                        </div>
                        
                        <div class="settings-option">
                            <div>
                                <h3>Términos y Condiciones</h3>
                                <p>Ver los términos de uso de la aplicación</p>
                            </div>
                            <button class="btn btn-secondary" id="viewTermsSettings">📄 Ver Términos</button>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <footer>
            <div class="container">
                <p>PediaCalc HPJRM v9.3.1 &copy; 2025 - Herramienta para Profesionales de la Salud</p>
            </div>
        </footer>
    </div>

    <script>
        // Base de datos completa de medicamentos pediátricos
        const initialMedicines = [
            // Antibióticos
            {
                id: "amoxicilina",
                nombre: "Amoxicilina",
                familia: "antibioticos",
                dosisHabitual: 80,
                unidad: "mg",
                frecuencia: "Cada 8 horas",
                presentaciones: [
                    { tipo: "Suspensión", concentracion: "250mg/5ml", presentacion: "Frasco 60ml", via: "oral" },
                    { tipo: "Cápsulas", concentracion: "500mg", presentacion: "Cápsulas 500mg", via: "oral" }
                ],
                dosisMaximaDiaria: 80,
                dosisMaximaSingle: 1000,
                indicaciones: ["Infecciones respiratorias", "Otitis media", "Infecciones de piel"],
                alertas: ["Puede causar diarrea", "Alergia a penicilinas"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            {
                id: "penicilina-cristalina",
                nombre: "Penicilina Cristalina",
                familia: "antibioticos",
                dosisHabitual: 250000,
                unidad: "UI",
                frecuencia: "Cada 6 horas",
                presentaciones: [
                    { tipo: "Inyectable", concentracion: "1000000UI", presentacion: "Bbo 1M UI", via: "iv/im" }
                ],
                dosisMaximaDiaria: 12000000,
                dosisMaximaSingle: 3000000,
                indicaciones: ["Infecciones graves", "Meningitis", "Neumonía"],
                alertas: ["Máximo 3.000.000 UI por dosis", "Máximo 12.000.000 UI al día"],
                liofilizado: true,
                dilucionEspecial: 10
            },
            {
                id: "penicilina-rapilenta",
                nombre: "Penicilina Rapilenta",
                familia: "antibioticos",
                dosisHabitual: 50000,
                unidad: "UI",
                frecuencia: "Una vez al día",
                presentaciones: [
                    { tipo: "Inyectable", concentracion: "1000000UI", presentacion: "Bbo 1M UI", via: "im" }
                ],
                dosisMaximaDiaria: 50000,
                dosisMaximaSingle: 1000000,
                indicaciones: ["Infecciones por estreptococo"],
                alertas: ["Diluir en 2ml de agua estéril"],
                liofilizado: false,
                dilucionEspecial: 2
            },
            {
                id: "ceftriaxona",
                nombre: "Ceftriaxona",
                familia: "antibioticos",
                dosisHabitual: 100,
                unidad: "mg",
                frecuencia: "Cada 24 horas",
                presentaciones: [
                    { tipo: "Inyectable", concentracion: "1g", presentacion: "Bbo 1g", via: "iv/im" }
                ],
                dosisMaximaDiaria: 4000,
                dosisMaximaSingle: 2000,
                indicaciones: ["Infecciones graves", "Meningitis"],
                alertas: ["No usar en neonatos con hiperbilirrubinemia"],
                liofilizado: true,
                dilucionEspecial: 10
            },
            {
                id: "cefalesxina",
                nombre: "Cefalesxina",
                familia: "antibioticos",
                dosisHabitual: 80,
                unidad: "mg",
                frecuencia: "Cada 8 horas",
                presentaciones: [
                    { tipo: "Cápsulas", concentracion: "500mg", presentacion: "Cápsulas 500mg", via: "oral" },
                    { tipo: "Suspensión", concentracion: "250mg/5ml", presentacion: "Frasco 60ml", via: "oral" }
                ],
                dosisMaximaDiaria: 80,
                dosisMaximaSingle: 1000,
                indicaciones: ["Infecciones de piel", "Infecciones urinarias", "Sinusitis"],
                alertas: ["Monitorizar función renal"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            {
                id: "azitromicina",
                nombre: "Azitromicina",
                familia: "antibioticos",
                dosisHabitual: 10,
                unidad: "mg",
                frecuencia: "Una vez al día",
                presentaciones: [
                    { tipo: "Tabletas", concentracion: "500mg", presentacion: "Tabletas 500mg", via: "oral" },
                    { tipo: "Suspensión", concentracion: "200mg/5ml", presentacion: "Frasco 30ml", via: "oral" }
                ],
                dosisMaximaDiaria: 10,
                dosisMaximaSingle: 500,
                indicaciones: ["Infecciones respiratorias", "Infecciones de piel"],
                alertas: ["Puede prolongar intervalo QT"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            // Analgésicos/Antipiréticos
            {
                id: "paracetamol",
                nombre: "Paracetamol",
                familia: "analgesicos",
                dosisHabitual: 15,
                unidad: "mg",
                frecuencia: "Cada 6 horas",
                presentaciones: [
                    { tipo: "Suspensión", concentracion: "120mg/5ml", presentacion: "Frasco 100ml", via: "oral" },
                    { tipo: "Tabletas", concentracion: "500mg", presentacion: "Tabletas 500mg", via: "oral" }
                ],
                dosisMaximaDiaria: 60,
                dosisMaximaSingle: 1000,
                indicaciones: ["Fiebre", "Dolor leve a moderado"],
                alertas: ["No exceder dosis máxima diaria", "Riesgo de hepatotoxicidad"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            {
                id: "ibuprofeno",
                nombre: "Ibuprofeno",
                familia: "analgesicos",
                dosisHabitual: 10,
                unidad: "mg",
                frecuencia: "Cada 6-8 horas",
                presentaciones: [
                    { tipo: "Suspensión", concentracion: "100mg/5ml", presentacion: "Frasco 100ml", via: "oral" }
                ],
                dosisMaximaDiaria: 40,
                dosisMaximaSingle: 800,
                indicaciones: ["Fiebre", "Dolor", "Inflamación"],
                alertas: ["Administrar con alimentos", "Riesgo de sangrado gastrointestinal"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            {
                id: "dipirona",
                nombre: "Dipirona",
                familia: "analgesicos",
                dosisHabitual: 15,
                unidad: "mg",
                frecuencia: "Cada 6 horas",
                presentaciones: [
                    { tipo: "Tabletas", concentracion: "500mg", presentacion: "Tabletas 500mg", via: "oral" },
                    { tipo: "Inyectable", concentracion: "600mg/2ml", presentacion: "Ampolla 2ml", via: "iv/im" }
                ],
                dosisMaximaDiaria: 65,
                dosisMaximaSingle: 1000,
                indicaciones: ["Fiebre", "Dolor intenso"],
                alertas: ["Riesgo de agranulocitosis"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            // Broncodilatadores
            {
                id: "salbutamol",
                nombre: "Salbutamol",
                familia: "broncodilatadores",
                dosisHabitual: 0.15,
                unidad: "mg",
                frecuencia: "Cada 6-8 horas",
                presentaciones: [
                    { tipo: "Aerosol", concentracion: "5mg/1ml", presentacion: "Nebulizador", via: "inhalatoria" },
                    { tipo: "Inhalador", concentracion: "100mcg/dosis", presentacion: "Inhalador 200 dosis", via: "inhalatoria" }
                ],
                dosisMaximaDiaria: 0.6,
                dosisMaximaSingle: 0.15,
                indicaciones: ["Asma", "Broncoespasmo"],
                alertas: ["Puede causar temblor", "Monitorizar frecuencia cardíaca"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            // Antihistamínicos
            {
                id: "loratadina",
                nombre: "Loratadina",
                familia: "antihistaminicos",
                dosisHabitual: 0.2,
                unidad: "mg",
                frecuencia: "Una vez al día",
                presentaciones: [
                    { tipo: "Tabletas", concentracion: "10mg", presentacion: "Tabletas 10mg", via: "oral" },
                    { tipo: "Jarabe", concentracion: "1mg/1ml", presentacion: "Frasco 100ml", via: "oral" }
                ],
                dosisMaximaDiaria: 0.2,
                dosisMaximaSingle: 10,
                indicaciones: ["Rinitis alérgica", "Urticaria"],
                alertas: ["Puede causar somnolencia"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            // Corticoides
            {
                id: "dexametasona",
                nombre: "Dexametasona",
                familia: "corticoides",
                dosisHabitual: 0.3,
                unidad: "mg",
                frecuencia: "Cada 12 horas",
                presentaciones: [
                    { tipo: "Tabletas", concentracion: "0.75mg", presentacion: "Tabletas 0.75mg", via: "oral" },
                    { tipo: "Inyectable", concentracion: "4mg/ml", presentacion: "Ampolla 1ml", via: "iv/im" }
                ],
                dosisMaximaDiaria: 0.6,
                dosisMaximaSingle: 8,
                indicaciones: ["Inflamación", "Alergias graves", "Edema cerebral"],
                alertas: ["No suspender abruptamente", "Monitorizar glucosa"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            // Gastrointestinales
            {
                id: "omeprazol",
                nombre: "Omeprazol",
                familia: "gastrointestinales",
                dosisHabitual: 1,
                unidad: "mg",
                frecuencia: "Una vez al día",
                presentaciones: [
                    { tipo: "Cápsulas", concentracion: "20mg", presentacion: "Cápsulas 20mg", via: "oral" }
                ],
                dosisMaximaDiaria: 2,
                dosisMaximaSingle: 40,
                indicaciones: ["Úlcera gástrica", "Reflujo gastroesofágico"],
                alertas: ["Administrar antes de alimentos"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            // Anticonvulsivantes
            {
                id: "diazepam",
                nombre: "Diazepam",
                familia: "anticonvulsivantes",
                dosisHabitual: 0.3,
                unidad: "mg",
                frecuencia: "Según necesidad",
                presentaciones: [
                    { tipo: "Inyectable", concentracion: "10mg/2ml", presentacion: "Ampolla 2ml", via: "iv/im" }
                ],
                dosisMaximaDiaria: 1,
                dosisMaximaSingle: 10,
                indicaciones: ["Estatus epiléptico", "Ansiedad", "Espasmos musculares"],
                alertas: ["Riesgo de depresión respiratoria", "Monitorizar signos vitales"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            // Antiparasitarios
            {
                id: "albendazol",
                nombre: "Albendazol",
                familia: "antiparasitarios",
                dosisHabitual: 15,
                unidad: "mg",
                frecuencia: "Dosis única",
                presentaciones: [
                    { tipo: "Tabletas", concentracion: "200mg", presentacion: "Tabletas 200mg", via: "oral" },
                    { tipo: "Suspensión", concentracion: "100mg/5ml", presentacion: "Frasco 10ml", via: "oral" }
                ],
                dosisMaximaDiaria: 15,
                dosisMaximaSingle: 400,
                indicaciones: ["Parásitos intestinales", "Giardiasis"],
                alertas: ["Administrar con alimentos grasos"],
                liofilizado: false,
                dilucionEspecial: 0
            },
            // Suplementos
            {
                id: "sulfato-zinc",
                nombre: "Sulfato de Zinc",
                familia: "suplementos",
                dosisHabitual: 20,
                unidad: "mg",
                frecuencia: "Una vez al día",
                presentaciones: [
                    { tipo: "Tabletas", concentracion: "10mg", presentacion: "Tabletas 10mg", via: "oral" },
                    { tipo: "Solución", concentracion: "10mg/5ml", presentacion: "Frasco 100ml", via: "oral" }
                ],
                dosisMaximaDiaria: 20,
                dosisMaximaSingle: 20,
                indicaciones: ["Suplemento mineral", "Diarrea aguda"],
                alertas: ["Administrar alejado de las comidas"],
                liofilizado: false,
                dilucionEspecial: 0
            }
        ];

        // Aplicación principal
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadMedicinesToSelect();
        });

        function initializeApp() {
            loadSettings();
            if (!localStorage.getItem('medicines')) {
                saveMedicines(initialMedicines);
            }
        }

        function setupEventListeners() {
            // Términos y condiciones
            document.getElementById('viewTerms').addEventListener('click', showTermsModal);
            document.getElementById('viewTermsSettings').addEventListener('click', showTermsModal);
            document.getElementById('acceptTerms').addEventListener('click', acceptTerms);
            document.getElementById('termsClose').addEventListener('click', closeTermsModal);
            document.getElementById('startApp').addEventListener('click', startApp);

            // Navegación
            document.getElementById('menuToggle').addEventListener('click', toggleSidebar);
            document.getElementById('sidebarClose').addEventListener('click', toggleSidebar);
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', handleNavigation);
            });

            // Calculadora
            document.getElementById('medicineCategory').addEventListener('change', updateMedicineSelect);
            document.getElementById('medicineSelect').addEventListener('change', updatePresentationSelect);
            document.getElementById('presentationSelect').addEventListener('change', checkDilutionRequired);
            document.getElementById('calculateBtn').addEventListener('click', calculateDose);
            document.getElementById('closeResult').addEventListener('click', closeResult);

            // Gestión
            document.getElementById('addMedicineBtn').addEventListener('click', showMedicineForm);
            document.getElementById('cancelFormBtn').addEventListener('click', hideMedicineForm);
            document.getElementById('medicineFormElement').addEventListener('submit', saveMedicine);
            document.getElementById('addPresentationBtn').addEventListener('click', addPresentationField);
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            document.getElementById('importFile').addEventListener('change', importData);
            document.getElementById('updateFromGithubBtn').addEventListener('click', updateFromGithub);

            // Configuración
            document.getElementById('darkModeToggle').addEventListener('change', toggleDarkMode);
            document.getElementById('fontSizeSelect').addEventListener('change', changeFontSize);
            document.getElementById('exportSettingsBtn').addEventListener('click', exportData);
            document.getElementById('resetDataBtn').addEventListener('click', resetData);
        }

        // Funciones de términos y condiciones
        function showTermsModal() {
            document.getElementById('termsModal').classList.add('active');
            startCountdown();
        }

        function startCountdown() {
            let countdown = 10;
            const countdownElement = document.getElementById('countdown');
            const acceptBtn = document.getElementById('acceptTerms');
            
            acceptBtn.disabled = true;
            acceptBtn.textContent = 'Aceptar Términos';
            
            const interval = setInterval(() => {
                countdown--;
                countdownElement.textContent = `Aceptar términos en: ${countdown} segundos`;
                
                if (countdown <= 0) {
                    clearInterval(interval);
                    acceptBtn.disabled = false;
                }
            }, 1000);
        }

        function acceptTerms() {
            document.getElementById('termsModal').classList.remove('active');
            document.getElementById('welcomeSection').classList.remove('active');
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('calculatorSection').classList.add('active');
        }

        function closeTermsModal() {
            document.getElementById('termsModal').classList.remove('active');
        }

        function startApp() {
            document.getElementById('welcomeSection').classList.remove('active');
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('calculatorSection').classList.add('active');
        }

        // Funciones de navegación
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function handleNavigation(e) {
            e.preventDefault();
            const targetSection = this.getAttribute('data-section');
            
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            this.classList.add('active');
            document.getElementById(`${targetSection}Section`).classList.add('active');
            
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
            
            if (targetSection === 'database') {
                loadMedicinesGrid();
            } else if (targetSection === 'management') {
                loadManagementList();
            }
        }

        // Funciones de la calculadora
        function loadMedicinesToSelect() {
            const medicines = getMedicines();
            const categorySelect = document.getElementById('medicineCategory');
            const medicineSelect = document.getElementById('medicineSelect');
            
            medicineSelect.innerHTML = '<option value="">Seleccione un medicamento</option>';
            
            const filteredMedicines = categorySelect.value ? 
                medicines.filter(med => med.familia === categorySelect.value) : medicines;
            
            filteredMedicines.forEach(med => {
                const option = document.createElement('option');
                option.value = med.id;
                option.textContent = med.nombre;
                medicineSelect.appendChild(option);
            });
        }

        function updateMedicineSelect() {
            loadMedicinesToSelect();
            document.getElementById('presentationSelect').innerHTML = '<option value="">Seleccione una presentación</option>';
            document.getElementById('dilutionGroup').style.display = 'none';
        }

        function updatePresentationSelect() {
            const medicineId = document.getElementById('medicineSelect').value;
            const presentationSelect = document.getElementById('presentationSelect');
            
            presentationSelect.innerHTML = '<option value="">Seleccione una presentación</option>';
            
            if (medicineId) {
                const medicine = getMedicineById(medicineId);
                medicine.presentaciones.forEach(presentation => {
                    const option = document.createElement('option');
                    option.value = JSON.stringify(presentation);
                    option.textContent = `${presentation.tipo} - ${presentation.concentracion} (${presentation.presentacion})`;
                    presentationSelect.appendChild(option);
                });
            }
        }

        function checkDilutionRequired() {
            const medicineId = document.getElementById('medicineSelect').value;
            if (medicineId) {
                const medicine = getMedicineById(medicineId);
                document.getElementById('dilutionGroup').style.display = medicine.liofilizado ? 'block' : 'none';
            }
        }

        function calculateDose() {
            const weight = parseFloat(document.getElementById('patientWeight').value);
            const medicineId = document.getElementById('medicineSelect').value;
            const presentationValue = document.getElementById('presentationSelect').value;
            const dilutionVolume = parseFloat(document.getElementById('dilutionVolume').value) || 0;

            if (!validateInputs(weight, medicineId, presentationValue)) return;

            const medicine = getMedicineById(medicineId);
            const presentation = JSON.parse(presentationValue);
            const result = calculateMedicineDose(weight, medicine, presentation, dilutionVolume);
            
            displayResult(result);
        }

        function validateInputs(weight, medicineId, presentationValue) {
            if (!weight || weight < 0.1) {
                showAlert('Por favor ingrese un peso válido (mínimo 0.1 kg)', 'danger');
                return false;
            }
            if (!medicineId) {
                showAlert('Por favor seleccione un medicamento', 'danger');
                return false;
            }
            if (!presentationValue) {
                showAlert('Por favor seleccione una presentación', 'danger');
                return false;
            }
            return true;
        }

        function calculateMedicineDose(weight, medicine, presentation, dilutionVolume) {
            // Obtener concentración numérica
            const concentrationMatch = presentation.concentracion.match(/(\d+(\.\d+)?)/);
            const concentration = concentrationMatch ? parseFloat(concentrationMatch[1]) : 1;
            
            // Calcular dosis diaria total
            let dailyDose = weight * medicine.dosisHabitual;
            
            // Aplicar límites
            if (medicine.dosisMaximaDiaria) {
                dailyDose = Math.min(dailyDose, medicine.dosisMaximaDiaria);
            }
            
            // Determinar número de tomas
            const dosesPerDay = getDosesPerDay(medicine.frecuencia);
            
            // Calcular dosis por toma
            let dosePerTake = dailyDose / dosesPerDay;
            
            if (medicine.dosisMaximaSingle) {
                dosePerTake = Math.min(dosePerTake, medicine.dosisMaximaSingle);
            }
            
            // Calcular volumen según el tipo de medicamento
            let volumePerTake;
            let units;
            
            if (medicine.liofilizado && dilutionVolume > 0) {
                // FÓRMULA CORREGIDA para liofilizados: (Dosis × Dilución) ÷ Concentración
                volumePerTake = (dosePerTake * dilutionVolume) / concentration;
            } else if (presentation.via === 'inhalatoria' && medicine.unidad === 'mg') {
                // Cálculo especial para aerosoles
                volumePerTake = Math.min(weight * 0.4, 15);
            } else if (presentation.concentracion.includes('/')) {
                // Para suspensiones: calcular ml basado en la concentración
                const [medAmount, liquidAmount] = presentation.concentracion.split('/').map(part => parseFloat(part));
                volumePerTake = (dosePerTake / medAmount) * liquidAmount;
            } else {
                // Para tabletas/cápsulas: calcular número de unidades
                units = Math.ceil(dosePerTake / concentration);
                if (medicine.dosisMaximaSingle && units > medicine.dosisMaximaSingle / concentration) {
                    units = Math.floor(medicine.dosisMaximaSingle / concentration);
                }
                volumePerTake = null; // No aplica volumen para formas sólidas
            }
            
            return {
                medicine,
                presentation,
                weight,
                dailyDose,
                dosePerTake,
                volumePerTake,
                units,
                dosesPerDay,
                dilutionVolume,
                concentration
            };
        }

        function getDosesPerDay(frequency) {
            if (frequency.includes('8 horas') || frequency.includes('3 veces')) return 3;
            if (frequency.includes('6 horas') || frequency.includes('4 veces')) return 4;
            if (frequency.includes('12 horas') || frequency.includes('2 veces')) return 2;
            if (frequency.includes('24 horas') || frequency.includes('1 vez')) return 1;
            return 1;
        }

        function displayResult(result) {
            let resultHTML = `
                <p><strong>Paciente:</strong> ${result.weight} kg</p>
                <p><strong>Medicamento:</strong> ${result.medicine.nombre}</p>
                <p><strong>Presentación:</strong> ${result.presentation.tipo} - ${result.presentation.concentracion}</p>
                <p><strong>Vía:</strong> ${result.presentation.via}</p>
                <p><strong>Frecuencia:</strong> ${result.medicine.frecuencia}</p>
                <p><strong>Dosis diaria total:</strong> ${formatNumber(result.dailyDose)} ${result.medicine.unidad}</p>
                <p><strong>Dosis por toma:</strong> ${formatNumber(result.dosePerTake)} ${result.medicine.unidad}</p>
            `;
            
            if (result.presentation.via === 'inhalatoria' && result.medicine.unidad === 'mg') {
                resultHTML += `<p><strong>Volumen a administrar:</strong> ${result.volumePerTake.toFixed(1)} gotas</p>`;
            } else if (result.volumePerTake !== null) {
                resultHTML += `<p><strong>Volumen a administrar:</strong> ${result.volumePerTake.toFixed(2)} ml</p>`;
                
                if (result.medicine.liofilizado) {
                    resultHTML += `<p><strong>Dilución utilizada:</strong> ${result.dilutionVolume} ml</p>`;
                    
                    if (result.volumePerTake < 10 && result.presentation.via === 'iv') {
                        resultHTML += `<p><strong>Completar con:</strong> ${(10 - result.volumePerTake).toFixed(2)} ml de SSF 0.9%</p>`;
                    }
                }
            } else if (result.units) {
                resultHTML += `<p><strong>Unidades a administrar:</strong> ${result.units} ${result.presentation.tipo.toLowerCase()}</p>`;
            }
            
            if (result.medicine.alertas && result.medicine.alertas.length > 0) {
                resultHTML += `<div class="alert alert-warning"><strong>Alertas:</strong> ${result.medicine.alertas.join(', ')}</div>`;
            }
            
            document.getElementById('resultContent').innerHTML = resultHTML;
            document.getElementById('resultCard').classList.add('active');
            document.getElementById('resultCard').scrollIntoView({ behavior: 'smooth' });
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + ' millones';
            } else if (num >= 1000) {
                return num.toLocaleString();
            }
            return num.toFixed(2);
        }

        function closeResult() {
            document.getElementById('resultCard').classList.remove('active');
        }

        // Funciones de gestión
        function showMedicineForm() {
            document.getElementById('medicineForm').style.display = 'block';
            document.getElementById('formTitle').textContent = 'Agregar Nuevo Medicamento';
            document.getElementById('medicineId').value = '';
            document.getElementById('medicineFormElement').reset();
            document.getElementById('presentationsContainer').innerHTML = '';
            addPresentationField();
        }

        function hideMedicineForm() {
            document.getElementById('medicineForm').style.display = 'none';
        }

        function addPresentationField() {
            const container = document.getElementById('presentationsContainer');
            const div = document.createElement('div');
            div.className = 'presentation-item';
            div.innerHTML = `
                <input type="text" placeholder="Tipo (ej: Tabletas)" class="presentation-type" required>
                <input type="text" placeholder="Concentración (ej: 500mg)" class="presentation-concentration" required>
                <input type="text" placeholder="Presentación (ej: Tabletas 500mg)" class="presentation-presentation" required>
                <input type="text" placeholder="Vía (ej: oral)" class="presentation-route" required>
                <button type="button" class="btn btn-danger btn-small remove-presentation">✕</button>
            `;
            container.appendChild(div);
            
            div.querySelector('.remove-presentation').addEventListener('click', function() {
                if (container.children.length > 1) {
                    div.remove();
                }
            });
        }

        function saveMedicine(e) {
            e.preventDefault();
            
            const medicine = {
                id: document.getElementById('medicineId').value || generateId(),
                nombre: document.getElementById('formName').value,
                familia: document.getElementById('formFamily').value,
                dosisHabitual: parseFloat(document.getElementById('formDoseHabitual').value),
                unidad: document.getElementById('formUnit').value,
                frecuencia: document.getElementById('formFrequency').value,
                presentaciones: getPresentationsFromForm(),
                dosisMaximaDiaria: document.getElementById('formDoseMaxDaily').value ? parseFloat(document.getElementById('formDoseMaxDaily').value) : null,
                dosisMaximaSingle: document.getElementById('formDoseMaxSingle').value ? parseFloat(document.getElementById('formDoseMaxSingle').value) : null,
                indicaciones: document.getElementById('formIndications').value ? document.getElementById('formIndications').value.split(',').map(s => s.trim()) : [],
                alertas: document.getElementById('formAlerts').value ? document.getElementById('formAlerts').value.split(',').map(s => s.trim()) : [],
                liofilizado: document.getElementById('formLiofilizado').checked,
                dilucionEspecial: parseFloat(document.getElementById('formDilution').value) || 0
            };
            
            const medicines = getMedicines();
            const existingIndex = medicines.findIndex(m => m.id === medicine.id);
            
            if (existingIndex >= 0) {
                medicines[existingIndex] = medicine;
                showAlert('Medicamento actualizado correctamente', 'success');
            } else {
                medicines.push(medicine);
                showAlert('Medicamento agregado correctamente', 'success');
            }
            
            saveMedicines(medicines);
            hideMedicineForm();
            loadManagementList();
            loadMedicinesToSelect();
        }

        function getPresentationsFromForm() {
            const presentations = [];
            document.querySelectorAll('.presentation-item').forEach(item => {
                presentations.push({
                    tipo: item.querySelector('.presentation-type').value,
                    concentracion: item.querySelector('.presentation-concentration').value,
                    presentacion: item.querySelector('.presentation-presentation').value,
                    via: item.querySelector('.presentation-route').value
                });
            });
            return presentations;
        }

        function loadManagementList() {
            const container = document.getElementById('managementList');
            const medicines = getMedicines();
            
            container.innerHTML = '';
            
            medicines.forEach(medicine => {
                const div = document.createElement('div');
                div.className = 'medicine-item card';
                div.innerHTML = `
                    <div class="medicine-info">
                        <h3>${medicine.nombre}</h3>
                        <p><strong>Familia:</strong> ${medicine.familia}</p>
                        <p><strong>Dosis:</strong> ${medicine.dosisHabitual} ${medicine.unidad}/kg/día - ${medicine.frecuencia}</p>
                        <p><strong>Presentaciones:</strong> ${medicine.presentaciones.map(p => p.tipo).join(', ')}</p>
                    </div>
                    <div class="medicine-actions">
                        <button class="btn btn-secondary btn-small edit-medicine" data-id="${medicine.id}">✏️ Editar</button>
                        <button class="btn btn-danger btn-small delete-medicine" data-id="${medicine.id}">🗑️ Eliminar</button>
                    </div>
                `;
                container.appendChild(div);
            });
            
            // Agregar event listeners para editar y eliminar
            document.querySelectorAll('.edit-medicine').forEach(btn => {
                btn.addEventListener('click', function() {
                    editMedicine(this.getAttribute('data-id'));
                });
            });
            
            document.querySelectorAll('.delete-medicine').forEach(btn => {
                btn.addEventListener('click', function() {
                    deleteMedicine(this.getAttribute('data-id'));
                });
            });
        }

        function editMedicine(id) {
            const medicine = getMedicineById(id);
            if (!medicine) return;
            
            document.getElementById('medicineForm').style.display = 'block';
            document.getElementById('formTitle').textContent = 'Editar Medicamento';
            document.getElementById('medicineId').value = medicine.id;
            document.getElementById('formName').value = medicine.nombre;
            document.getElementById('formFamily').value = medicine.familia;
            document.getElementById('formDoseHabitual').value = medicine.dosisHabitual;
            document.getElementById('formUnit').value = medicine.unidad;
            document.getElementById('formFrequency').value = medicine.frecuencia;
            document.getElementById('formDoseMaxDaily').value = medicine.dosisMaximaDiaria || '';
            document.getElementById('formDoseMaxSingle').value = medicine.dosisMaximaSingle || '';
            document.getElementById('formIndications').value = medicine.indicaciones.join(', ');
            document.getElementById('formAlerts').value = medicine.alertas.join(', ');
            document.getElementById('formLiofilizado').checked = medicine.liofilizado || false;
            document.getElementById('formDilution').value = medicine.dilucionEspecial || 10;
            
            // Cargar presentaciones
            document.getElementById('presentationsContainer').innerHTML = '';
            medicine.presentaciones.forEach((presentation, index) => {
                addPresentationField();
                const lastItem = document.getElementById('presentationsContainer').lastElementChild;
                lastItem.querySelector('.presentation-type').value = presentation.tipo;
                lastItem.querySelector('.presentation-concentration').value = presentation.concentracion;
                lastItem.querySelector('.presentation-presentation').value = presentation.presentacion;
                lastItem.querySelector('.presentation-route').value = presentation.via;
            });
        }

        function deleteMedicine(id) {
            if (confirm('¿Está seguro de que desea eliminar este medicamento?')) {
                const medicines = getMedicines().filter(m => m.id !== id);
                saveMedicines(medicines);
                showAlert('Medicamento eliminado correctamente', 'success');
                loadManagementList();
                loadMedicinesToSelect();
            }
        }

        function loadMedicinesGrid() {
            const container = document.getElementById('medicinesGrid');
            const medicines = getMedicines();
            
            container.innerHTML = '';
            
            medicines.forEach(medicine => {
                const card = document.createElement('div');
                card.className = 'card medicine-card';
                card.innerHTML = `
                    <div class="medicine-family">${medicine.familia}</div>
                    <h3 class="card-title">${medicine.nombre}</h3>
                    <div class="medicine-details">
                        <p><strong>Dosis habitual:</strong> ${medicine.dosisHabitual} ${medicine.unidad}/kg/día</p>
                        <p><strong>Frecuencia:</strong> ${medicine.frecuencia}</p>
                        <p><strong>Presentaciones:</strong> ${medicine.presentaciones.map(p => `${p.tipo} (${p.concentracion})`).join(', ')}</p>
                        <p><strong>Vías:</strong> ${[...new Set(medicine.presentaciones.map(p => p.via))].join(', ')}</p>
                        ${medicine.indicaciones.length > 0 ? `<p><strong>Indicaciones:</strong> ${medicine.indicaciones.join(', ')}</p>` : ''}
                        ${medicine.alertas.length > 0 ? `<p><strong>Alertas:</strong> ${medicine.alertas.join(', ')}</p>` : ''}
                    </div>
                `;
                container.appendChild(card);
            });
            
            // Implementar búsqueda
            document.getElementById('searchInput').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const cards = container.querySelectorAll('.medicine-card');
                
                cards.forEach(card => {
                    const text = card.textContent.toLowerCase();
                    card.style.display = text.includes(searchTerm) ? 'block' : 'none';
                });
            });
        }

        // Funciones de importación/exportación
        function exportData() {
            const medicines = getMedicines();
            const dataStr = JSON.stringify(medicines, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'pediacalc_database.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showAlert('Base de datos exportada correctamente', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const medicines = JSON.parse(e.target.result);
                    if (Array.isArray(medicines)) {
                        saveMedicines(medicines);
                        showAlert('Base de datos importada correctamente', 'success');
                        loadManagementList();
                        loadMedicinesToSelect();
                    } else {
                        showAlert('El archivo no contiene una base de datos válida', 'danger');
                    }
                } catch (error) {
                    showAlert('Error al importar el archivo: ' + error.message, 'danger');
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // Reset input
        }

        async function updateFromGithub() {
            const url = document.getElementById('githubUrl').value || 'https://raw.githubusercontent.com/tu-usuario/pediacalc/main/database.json';
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Error al descargar el archivo');
                
                const medicines = await response.json();
                if (Array.isArray(medicines)) {
                    saveMedicines(medicines);
                    showAlert('Base de datos actualizada desde GitHub correctamente', 'success');
                    loadManagementList();
                    loadMedicinesToSelect();
                } else {
                    showAlert('El archivo de GitHub no contiene una base de datos válida', 'danger');
                }
            } catch (error) {
                showAlert('Error al actualizar desde GitHub: ' + error.message, 'danger');
            }
        }

        // Funciones de configuración
        function loadSettings() {
            const darkMode = localStorage.getItem('darkMode') === 'true';
            const fontSize = localStorage.getItem('fontSize') || 'medium';
            
            if (darkMode) {
                document.body.classList.add('dark-theme');
                document.getElementById('darkModeToggle').checked = true;
            }
            
            document.getElementById('fontSizeSelect').value = fontSize;
            applyFontSize(fontSize);
        }

        function toggleDarkMode() {
            const isDark = document.getElementById('darkModeToggle').checked;
            document.body.classList.toggle('dark-theme', isDark);
            localStorage.setItem('darkMode', isDark);
        }

        function changeFontSize() {
            const size = document.getElementById('fontSizeSelect').value;
            applyFontSize(size);
            localStorage.setItem('fontSize', size);
        }

        function applyFontSize(size) {
            document.body.style.fontSize = size === 'small' ? '14px' : size === 'large' ? '18px' : '16px';
        }

        function resetData() {
            if (confirm('¿Está seguro de que desea restablecer la base de datos a los valores originales? Se perderán todos los cambios.')) {
                saveMedicines(initialMedicines);
                showAlert('Base de datos restablecida correctamente', 'success');
                loadManagementList();
                loadMedicinesToSelect();
            }
        }

        // Funciones auxiliares
        function getMedicines() {
            const stored = localStorage.getItem('medicines');
            return stored ? JSON.parse(stored) : initialMedicines;
        }

        function saveMedicines(medicines) {
            localStorage.setItem('medicines', JSON.stringify(medicines));
        }

        function getMedicineById(id) {
            return getMedicines().find(med => med.id === id);
        }

        function generateId() {
            return 'med-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }

        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            const main = document.querySelector('main .container');
            main.insertBefore(alert, main.firstChild);
            
            setTimeout(() => alert.remove(), 5000);
        }
    </script>
</body>
</html>
